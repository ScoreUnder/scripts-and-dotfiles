#!/bin/sh
eval set -- "$(getopt -n bg-random -o n -l dry-run -- "$@")"
dry=false
while [ "$1" != -- ]; do
    case "$1" in
        -n|--dry-run) dry=true;;
    esac
    shift
done
shift

if [ "$#" = 0 ]; then
    set -- ~/img/wallpaper_safe
    hr=$(date +%H)
    if [ "$hr" -lt 9 ] || [ "$hr" -ge 18 ]; then
        set -- "$@" ~/img/wallpaper
    fi
fi
fn="$(find "$@" -type f -print0 | shuf -zn1 | tr -d \\0; echo x)"; fn=${fn%x}
if "$dry"
then echo "$fn"
else exec feh --bg-fill "$fn"
fi
